<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NSSO CapEX Form</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
      }

      .form-container {
        max-width: 500px;
        margin: 50px auto;
        background-color: #ffffff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        text-align: left;
      }

      h2 {
        text-align: center;
        color: #333;
      }

      h3 {
        color: #555;
        margin-bottom: 20px;
      }

      label {
        font-weight: bold;
        margin-bottom: 10px;
        display: block;
      }

      input[type='text'],
      input[type='email'],
      input[type='date'],
      input[type='tel'] {
        width: 95%;
        padding: 8px;
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      .radio-group label,
      .checkbox-group label {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }

      .radio-group label input,
      .checkbox-group label input {
        margin-right: 10px;
      }

      .button-container {
        display: flex;
        justify-content: space-between;
      }

      button {
        padding: 10px 20px;
        background-color: #007bff;
        color: #ffffff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 20px;
      }

      button:hover {
        background-color: #0056b3;
      }

      .error {
        color: red;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="form-container">
      <h2>NSSO CapEX Form</h2>
      <div id="formContainer"></div>
    </div>

    <script>
      const formJSON = {
        questions: [
          {
            id: 'question_1',
            label: 'Identification Details',
            fields: [
              {
                label: 'CIN Number',
                inputType: 'text',
                name: 'cin_number',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'CIN Number is required.',
                },
              },
              {
                label: 'Legal Name',
                inputType: 'text',
                name: 'legal_name',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Legal Name is required.',
                },
              },
              {
                label: 'Operating Name',
                inputType: 'text',
                name: 'operating_name',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Operating Name is required.',
                },
              },
              {
                label: 'Company Address',
                inputType: 'text',
                name: 'company_address',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Company Address is required.',
                },
              },
              {
                label: 'Email',
                inputType: 'email',
                name: 'email',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Email is required.',
                },
              },
              {
                label: 'GST',
                inputType: 'text',
                name: 'gst',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'GST is required.',
                },
              },
            ],
            next: 'question_2',
          },
          {
            id: 'question_2',
            label: 'Person for Questionnaire',
            fields: [
              {
                label: 'First Name',
                inputType: 'text',
                name: 'first_name',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'First Name is required.',
                },
              },
              {
                label: 'Last Name',
                inputType: 'text',
                name: 'last_name',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Last Name is required.',
                },
              },
              {
                label: 'Designation',
                inputType: 'text',
                name: 'designation',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Designation is required.',
                },
              },
              {
                label: 'Email',
                inputType: 'email',
                name: 'person_email',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Email is required.',
                },
              },
              {
                label: 'Postal Address',
                inputType: 'text',
                name: 'postal_address',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Postal Address is required.',
                },
              },
              {
                label: 'Mobile Number',
                inputType: 'tel',
                name: 'mobile_number',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Mobile Number is required.',
                },
              },
              {
                label: 'Telephone Number',
                inputType: 'tel',
                name: 'telephone_number',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Telephone Number is required.',
                },
              },
            ],
            prev: 'question_1',
            next: 'question_3',
          },
          {
            id: 'question_3',
            label: 'Is the company operational?',
            fields: [
              {
                label: 'Operational Status',
                inputType: 'radio',
                name: 'operational_status',
                options: [
                  { label: 'Yes', value: 'yes' },
                  { label: 'No', value: 'no' },
                ],
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Please select the operational status.',
                },
              },
            ],
            prev: 'question_2',
            next: {
              yes: 'question_4',
              no: 'question_3_1',
            },
          },
          {
            id: 'question_3_1',
            label: 'Why is this current company not operational?',
            fields: [
              {
                label: 'Reason for Non-Operational Status',
                inputType: 'radio',
                name: 'non_operational_reason',
                options: [
                  {
                    label: 'Seasonal operations',
                    value: 'seasonal_operations',
                  },
                  {
                    label: 'Ceased/strike off operations',
                    value: 'ceased_operations',
                  },
                  { label: 'Sold operations', value: 'sold_operations' },
                  {
                    label: 'Amalgamated with other enterprises',
                    value: 'amalgamated_operations',
                  },
                  {
                    label: 'Temporarily inactive but will reopen',
                    value: 'temporarily_inactive',
                  },
                  {
                    label: 'No longer operating due to other reasons',
                    value: 'other_reasons',
                  },
                ],
                value: '',
                validation: {
                  required: true,
                  errorMessage:
                    'Please select a reason for non-operational status.',
                },
              },
            ],
            prev: 'question_3',
            next: {
              seasonal_operations: 'question_3_1_1',
              ceased_operations: 'question_3_1_2',
              sold_operations: 'question_3_1_3',
              amalgamated_operations: 'question_3_1_4',
              temporarily_inactive: 'question_3_1_5',
              other_reasons: 'question_3_1_6',
            },
          },
          {
            id: 'question_3_1_2',
            label: 'Details of Strike off Operations',
            fields: [
              {
                label: 'When did the enterprise cease operations?',
                inputType: 'date',
                name: 'cease_date',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Cease date is required.',
                },
              },
              {
                label: 'Why did the enterprise cease operations?',
                inputType: 'checkbox',
                name: 'cease_reasons',
                options: [
                  { label: 'Bankruptcy', value: 'bankruptcy' },
                  { label: 'Liquidation', value: 'liquidation' },
                  { label: 'Dissolution', value: 'dissolution' },
                  { label: 'Other', value: 'other' },
                ],
                value: [],
                validation: {
                  required: true,
                  errorMessage: 'Please select at least one reason.',
                },
              },
              {
                label: 'If other, please specify (max 250 characters)',
                inputType: 'text',
                name: 'other_reason',
                value: '',
                validation: {
                  required: false,
                  maxLength: 250,
                  errorMessage: 'Maximum 250 characters allowed.',
                },
              },
            ],
            prev: 'question_3_1',
            next: 'question_4',
          },
          {
            id: 'question_3_1_2',
            label: 'Details of Strike off Operations',
            fields: [
              {
                label: 'When did the enterprise cease operations?',
                inputType: 'date',
                name: 'cease_date',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Cease date is required.',
                },
              },
              {
                label: 'Why did the enterprise cease operations?',
                inputType: 'checkbox',
                name: 'cease_reasons',
                options: [
                  { label: 'Bankruptcy', value: 'bankruptcy' },
                  { label: 'Liquidation', value: 'liquidation' },
                  { label: 'Dissolution', value: 'dissolution' },
                  { label: 'Other', value: 'other' },
                ],
                value: [],
                validation: {
                  required: true,
                  errorMessage: 'Please select at least one reason.',
                },
              },
              {
                label: 'If other, please specify (max 250 characters)',
                inputType: 'text',
                name: 'other_reason',
                value: '',
                validation: {
                  required: false,
                  maxLength: 250,
                  errorMessage: 'Maximum 250 characters allowed.',
                },
              },
            ],
            prev: 'question_3_1',
            next: 'question_4',
          },
          {
            id: 'question_3_1_3',
            label: 'Details of Sold Operations',
            fields: [
              {
                label: 'When was this enterprise sold?',
                inputType: 'date',
                name: 'sale_date',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Sale date is required.',
                },
              },
              {
                label: 'What is the CIN of the buyer?',
                inputType: 'text',
                name: 'buyer_cin',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Buyer CIN is required.',
                },
              },
              {
                label: 'What is the legal name of the buyer?',
                inputType: 'text',
                name: 'buyer_legal_name',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Buyer legal name is required.',
                },
              },
            ],
            prev: 'question_3_1',
            next: 'question_4',
          },
          {
            id: 'question_3_1_4',
            label: 'Details of Amalgamation',
            fields: [
              {
                label: 'When did this enterprise amalgamate?',
                inputType: 'date',
                name: 'amalgamation_date',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Amalgamation date is required.',
                },
              },
              {
                label:
                  'What is the CIN of the resulting or continuing enterprise?',
                inputType: 'text',
                name: 'resulting_enterprise_cin',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'CIN of resulting enterprise is required.',
                },
              },
              {
                label:
                  'What is the legal name of the resulting or continuing enterprise?',
                inputType: 'text',
                name: 'resulting_enterprise_legal_name',
                value: '',
                validation: {
                  required: true,
                  errorMessage:
                    'Legal name of resulting enterprise is required.',
                },
              },
              {
                label:
                  'What are the CINs of other enterprises amalgamated with the resulting or continuing enterprise?',
                inputType: 'text',
                name: 'amalgamated_enterprise_cins',
                value: '',
                validation: {
                  required: false,
                  errorMessage:
                    'CINs of other amalgamated enterprises (if any).',
                },
              },
              {
                label:
                  'What are the legal names of other enterprises amalgamated with the resulting or continuing enterprise?',
                inputType: 'text',
                name: 'amalgamated_enterprise_names',
                value: '',
                validation: {
                  required: false,
                  errorMessage:
                    'Legal names of other amalgamated enterprises (if any).',
                },
              },
            ],
            prev: 'question_3_1',
            next: 'question_4',
          },
          {
            id: 'question_3_1_5',
            label: 'Temporarily Inactive but Expected to Reopen',
            fields: [
              {
                label: 'When did this enterprise become temporarily inactive?',
                inputType: 'date',
                name: 'inactive_since',
                value: '',
                validation: {
                  required: true,
                  errorMessage:
                    'Date when the enterprise became temporarily inactive is required.',
                },
              },
              {
                label: 'When does this enterprise expect to resume operations?',
                inputType: 'date',
                name: 'resume_operations',
                value: '',
                validation: {
                  required: true,
                  errorMessage:
                    'Expected date to resume operations is required.',
                },
              },
              {
                label: 'Why is this enterprise temporarily inactive?',
                inputType: 'text',
                name: 'reason_inactive',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Reason for temporary inactivity is required.',
                },
              },
            ],
            prev: 'question_3_1',
            next: 'question_4',
          },
          {
            id: 'question_3_1_6',
            label: 'No Longer Operational Due to Other Reasons',
            fields: [
              {
                label: 'When did this enterprise stop operations?',
                inputType: 'date',
                name: 'stop_operations_date',
                value: '',
                validation: {
                  required: true,
                  errorMessage:
                    'Date when the enterprise stopped operations is required.',
                },
              },
              {
                label: 'Why did this enterprise stop operations?',
                inputType: 'text',
                name: 'reason_stop_operations',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Reason for stopping operations is required.',
                },
              },
            ],
            prev: 'question_3_1',
            next: 'question_4', // Update the next question ID or endpoint
          },
          {
            id: 'question_3_1_1',
            label: 'Details of Seasonal Operations',
            fields: [
              {
                label: 'When did the enterprise cease operations?',
                inputType: 'date',
                name: 'cease_date',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Cease date is required.',
                },
              },
              {
                label: 'When does the enterprise expect to resume operations?',
                inputType: 'date',
                name: 'resume_date',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Resume date is required.',
                },
              },
            ],
            prev: 'question_3_1',
            next: 'question_4',
          },
          {
            id: 'question_4',
            label: 'Provide Business Operations',
            fields: [
              {
                label: 'Business Operations',
                inputType: 'checkbox',
                name: 'business_operations',
                options: [
                  { label: 'Manufacturing', value: 'manufacturing' },
                  { label: 'Retail', value: 'retail' },
                  { label: 'IT Services', value: 'it_services' },
                  { label: 'Logistics', value: 'logistics' },
                  { label: 'Consulting', value: 'consulting' },
                ],
                value: [],
                validation: {
                  required: true,
                  errorMessage:
                    'Please select at least one business operation.',
                },
              },
            ],
            prev: 'question_3',
            next: 'finish',
          },
        ],
      };

      let currentQuestionId = 'question_1';
      let currentRadioValueForRoute = '';

      function createForm(questionId) {
        const question = formJSON.questions.find((q) => q.id === questionId);
        if (!question) return;

        const formContainer = document.getElementById('formContainer');
        formContainer.innerHTML = '';

        const formElement = document.createElement('form');
        formElement.id = 'signupForm';
        formElement.method = 'GET';

        const questionLabel = document.createElement('h3');
        questionLabel.innerText = question.label;
        formElement.appendChild(questionLabel);

        question.fields.forEach((field) => {
          const label = document.createElement('label');
          label.innerText = `${field.label}:`;
          formElement.appendChild(label);

          if (field.inputType === 'radio' || field.inputType === 'checkbox') {
            const group = document.createElement('div');
            group.className =
              field.inputType === 'radio' ? 'radio-group' : 'checkbox-group';

            field.options.forEach((option) => {
              const optionLabel = document.createElement('label');
              const input = document.createElement('input');
              input.type = field.inputType;
              input.name = field.name;
              input.value = option.value;
              if (field.inputType === 'checkbox') {
                input.checked = field.value.includes(option.value);
              } else if (field.value === option.value) {
                input.checked = true;
              }
              optionLabel.appendChild(input);
              optionLabel.appendChild(document.createTextNode(option.label));
              group.appendChild(optionLabel);
            });

            formElement.appendChild(group);
          } else {
            const input = document.createElement('input');
            input.type = field.inputType;
            input.id = field.name;
            input.name = field.name;
            input.value = field.value;
            formElement.appendChild(input);
          }

          const errorSpan = document.createElement('span');
          errorSpan.id = `${field.name}Error`;
          errorSpan.className = 'error';
          errorSpan.innerText = field.validation.errorMessage;
          formElement.appendChild(errorSpan);
        });

        const navigationButtons = document.createElement('div');
        navigationButtons.className = 'button-container';

        const prevButton = document.createElement('button');
        prevButton.type = 'button';
        prevButton.innerText = 'Back';
        prevButton.disabled = !question.prev;
        prevButton.addEventListener('click', function () {
          saveFormData();
          if (question.prev) {
            currentQuestionId = question.prev;
            createForm(currentQuestionId);
          }
        });
        navigationButtons.appendChild(prevButton);

        const nextButton = document.createElement('button');
        nextButton.type = 'button';
        nextButton.innerText = 'Next';
        nextButton.addEventListener('click', function () {
          if (validateForm()) {
            saveFormData();
            if (question.next) {
              if (typeof question.next === 'object') {
                // Handle dynamic next question navigation

                const operationalStatus = document.querySelector(
                  `[name="${currentRadioValueForRoute}"]:checked`
                )?.value;
                currentQuestionId = question.next[operationalStatus];
                currentRadioValueForRoute = '';
              } else {
                currentQuestionId = question.next;
              }
              if (currentQuestionId === 'finish') {
                downloadJSONFile();
              } else {
                createForm(currentQuestionId);
              }
            }
          }
        });
        navigationButtons.appendChild(nextButton);

        formElement.appendChild(navigationButtons);
        formContainer.appendChild(formElement);
      }

      function saveFormData() {
        const formElement = document.getElementById('signupForm');
        const currentQuestion = formJSON.questions.find(
          (q) => q.id === currentQuestionId
        );
        currentQuestion.fields.forEach((field) => {
          const input = formElement.querySelector(`[name="${field.name}"]`);
          if (input) {
            if (input.type === 'checkbox') {
              field.value = Array.from(
                formElement.querySelectorAll(`[name="${field.name}"]:checked`)
              ).map((el) => el.value);
            } else if (input.type === 'radio') {
              field.value =
                formElement.querySelector(`[name="${field.name}"]:checked`)
                  ?.value || '';
              currentRadioValueForRoute = field.name;
            } else {
              field.value = input.value;
            }
          }
        });
      }

      function validateForm() {
        let isValid = true;
        const formElement = document.getElementById('signupForm');

        const currentQuestion = formJSON.questions.find(
          (q) => q.id === currentQuestionId
        );
        currentQuestion.fields.forEach((field) => {
          const inputs = formElement.querySelectorAll(`[name="${field.name}"]`);
          const errorSpan = document.getElementById(`${field.name}Error`);

          if (field.validation.required) {
            if (field.inputType === 'checkbox') {
              const checkedCount = formElement.querySelectorAll(
                `[name="${field.name}"]:checked`
              ).length;
              if (checkedCount === 0) {
                errorSpan.style.display = 'block';
                isValid = false;
              } else {
                errorSpan.style.display = 'none';
              }
            } else if (field.inputType === 'radio') {
              if (
                !formElement.querySelector(`[name="${field.name}"]:checked`)
              ) {
                errorSpan.style.display = 'block';
                isValid = false;
              } else {
                errorSpan.style.display = 'none';
              }
            } else {
              if (!inputs[0]?.value) {
                errorSpan.style.display = 'block';
                isValid = false;
              } else {
                errorSpan.style.display = 'none';
              }
            }
          }
        });

        return isValid;
      }

      function downloadJSONFile() {
        const blob = new Blob([JSON.stringify(formJSON, null, 2)], {
          type: 'application/json',
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'form-data.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }

      createForm(currentQuestionId);
    </script>
  </body>
</html>
