<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NSSO CapEX Form</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
      }

      .form-container {
        max-width: 500px;
        margin: 50px auto;
        background-color: #ffffff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        text-align: left;
      }

      h2 {
        text-align: center;
        color: #333;
      }

      h3 {
        color: #555;
        margin-bottom: 20px;
      }

      label {
        font-weight: bold;
        margin-bottom: 10px;
        display: block;
      }

      input[type='text'],
      input[type='email'],
      input[type='date'],
      input[type='tel'] {
        width: 95%;
        padding: 8px;
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      .radio-group label,
      .checkbox-group label {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }

      .radio-group label input,
      .checkbox-group label input {
        margin-right: 10px;
      }

      .button-container {
        display: flex;
        justify-content: space-between;
      }

      button {
        padding: 10px 20px;
        background-color: #007bff;
        color: #ffffff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 20px;
      }

      button:hover {
        background-color: #0056b3;
      }

      .error {
        color: red;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="form-container">
      <h2>NSSO CapEX Form</h2>
      <div id="formContainer"></div>
    </div>

    <script>
      const formJSON = {
        questions: [
          {
            id: 'question_1',
            label: 'Identification Details',
            fields: [
              {
                label: 'CIN Number',
                inputType: 'text',
                name: 'cin_number',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'CIN Number is required.',
                },
              },
              {
                label: 'Legal Name',
                inputType: 'text',
                name: 'legal_name',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Legal Name is required.',
                },
              },
              {
                label: 'Operating Name',
                inputType: 'text',
                name: 'operating_name',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Operating Name is required.',
                },
              },
              {
                label: 'Company Address',
                inputType: 'text',
                name: 'company_address',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Company Address is required.',
                },
              },
              {
                label: 'Email',
                inputType: 'email',
                name: 'email',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Email is required.',
                },
              },
              {
                label: 'GST',
                inputType: 'text',
                name: 'gst',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'GST is required.',
                },
              },
            ],
            next: 'question_2',
          },
          {
            id: 'question_2',
            label: 'Person for Questionnaire',
            fields: [
              {
                label: 'First Name',
                inputType: 'text',
                name: 'first_name',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'First Name is required.',
                },
              },
              {
                label: 'Last Name',
                inputType: 'text',
                name: 'last_name',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Last Name is required.',
                },
              },
              {
                label: 'Designation',
                inputType: 'text',
                name: 'designation',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Designation is required.',
                },
              },
              {
                label: 'Email',
                inputType: 'email',
                name: 'person_email',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Email is required.',
                },
              },
              {
                label: 'Postal Address',
                inputType: 'text',
                name: 'postal_address',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Postal Address is required.',
                },
              },
              {
                label: 'Mobile Number',
                inputType: 'tel',
                name: 'mobile_number',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Mobile Number is required.',
                },
              },
              {
                label: 'Telephone Number',
                inputType: 'tel',
                name: 'telephone_number',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Telephone Number is required.',
                },
              },
            ],
            next: 'question_3',
            prev: 'question_1',
          },
          {
            id: 'question_3',
            label: 'Is the company operational?',
            fields: [
              {
                label: 'Operational Status',
                inputType: 'radio',
                name: 'operational_status',
                options: [
                  { label: 'Yes', value: 'yes' },
                  { label: 'No', value: 'no' },
                ],
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Please select the operational status.',
                },
              },
            ],
            next: { yes: 'question_3.1', no: 'question_4' },
            prev: 'question_2',
          },
          {
            id: 'question_3.1',
            label: 'Dummy Question 3.1',
            fields: [
              {
                label: 'Answer',
                inputType: 'text',
                name: 'dummy_answer',
                value: '',
                validation: {
                  required: true,
                  errorMessage: 'Answer is required.',
                },
              },
            ],
            next: 'question_4',
            prev: 'question_3',
          },
          {
            id: 'question_4',
            label: 'Provide Business Operations',
            fields: [
              {
                label: 'Business Operations',
                inputType: 'checkbox',
                name: 'business_operations',
                options: [
                  { label: 'Manufacturing', value: 'manufacturing' },
                  { label: 'Retail', value: 'retail' },
                  { label: 'IT Services', value: 'it_services' },
                  { label: 'Logistics', value: 'logistics' },
                  { label: 'Healthcare', value: 'healthcare' },
                ],
                value: [],
                validation: {
                  required: true,
                  errorMessage: 'Please select at least one operation.',
                },
              },
            ],
            prev: 'question_3',
            next: null,
          },
        ],
      };

      let currentQuestionId = 'question_1';

      function createForm(questionId) {
        const question = formJSON.questions.find((q) => q.id === questionId);
        if (!question) return;

        const formContainer = document.getElementById('formContainer');
        formContainer.innerHTML = '';

        const formElement = document.createElement('form');
        formElement.id = 'signupForm';
        formElement.method = 'GET';

        const questionLabel = document.createElement('h3');
        questionLabel.innerText = question.label;
        formElement.appendChild(questionLabel);

        question.fields.forEach((field) => {
          const label = document.createElement('label');
          label.innerText = `${field.label}:`;
          formElement.appendChild(label);

          if (field.inputType === 'radio' || field.inputType === 'checkbox') {
            const group = document.createElement('div');
            group.className =
              field.inputType === 'radio' ? 'radio-group' : 'checkbox-group';

            field.options.forEach((option) => {
              const optionLabel = document.createElement('label');
              const input = document.createElement('input');
              input.type = field.inputType;
              input.name = field.name;
              input.value = option.value;
              if (field.inputType === 'checkbox') {
                input.checked = field.value.includes(option.value);
              } else if (field.value === option.value) {
                input.checked = true;
              }
              optionLabel.appendChild(input);
              optionLabel.appendChild(document.createTextNode(option.label));
              group.appendChild(optionLabel);
            });

            formElement.appendChild(group);
          } else {
            const input = document.createElement('input');
            input.type = field.inputType;
            input.id = field.name;
            input.name = field.name;
            input.value = field.value;
            formElement.appendChild(input);
          }

          const errorSpan = document.createElement('span');
          errorSpan.id = `${field.name}Error`;
          errorSpan.className = 'error';
          errorSpan.innerText = field.validation.errorMessage;
          formElement.appendChild(errorSpan);
        });

        const navigationButtons = document.createElement('div');
        navigationButtons.className = 'button-container';

        const prevButton = document.createElement('button');
        prevButton.type = 'button';
        prevButton.innerText = 'Back';
        prevButton.disabled = !question.prev;
        prevButton.addEventListener('click', function () {
          saveFormData();
          if (question.prev) {
            currentQuestionId = question.prev;
            createForm(currentQuestionId);
          }
        });
        navigationButtons.appendChild(prevButton);

        const nextButton = document.createElement('button');
        nextButton.type = 'button';
        nextButton.innerText = 'Next';
        nextButton.addEventListener('click', function () {
          if (validateForm()) {
            saveFormData();
            if (question.next) {
              if (typeof question.next === 'object') {
                const operationalStatus = document.querySelector(
                  '[name="operational_status"]:checked'
                )?.value;
                currentQuestionId =
                  question.next[operationalStatus] || 'question_4';
              } else {
                currentQuestionId = question.next;
              }
              if (currentQuestionId === null) {
                downloadJSONFile();
              } else {
                createForm(currentQuestionId);
              }
            }
          }
        });
        navigationButtons.appendChild(nextButton);

        formElement.appendChild(navigationButtons);
        formContainer.appendChild(formElement);
      }

      function saveFormData() {
        const formElement = document.getElementById('signupForm');
        formJSON.questions
          .find((q) => q.id === currentQuestionId)
          .fields.forEach((field) => {
            const input = formElement.querySelector(`[name="${field.name}"]`);
            if (input) {
              if (input.type === 'checkbox') {
                field.value = Array.from(
                  formElement.querySelectorAll(`[name="${field.name}"]:checked`)
                ).map((el) => el.value);
              } else if (input.type === 'radio') {
                field.value =
                  formElement.querySelector(`[name="${field.name}"]:checked`)
                    ?.value || '';
              } else {
                field.value = input.value;
              }
            }
          });
      }

      function validateForm() {
        let isValid = true;
        const formElement = document.getElementById('signupForm');

        formJSON.questions
          .find((q) => q.id === currentQuestionId)
          .fields.forEach((field) => {
            const inputs = formElement.querySelectorAll(
              `[name="${field.name}"]`
            );
            const errorSpan = document.getElementById(`${field.name}Error`);

            if (field.validation.required) {
              if (field.inputType === 'checkbox') {
                const checkedCount = formElement.querySelectorAll(
                  `[name="${field.name}"]:checked`
                ).length;
                if (checkedCount === 0) {
                  errorSpan.style.display = 'block';
                  isValid = false;
                } else {
                  errorSpan.style.display = 'none';
                }
              } else if (field.inputType === 'radio') {
                if (
                  !formElement.querySelector(`[name="${field.name}"]:checked`)
                ) {
                  errorSpan.style.display = 'block';
                  isValid = false;
                } else {
                  errorSpan.style.display = 'none';
                }
              } else {
                if (!inputs[0]?.value) {
                  errorSpan.style.display = 'block';
                  isValid = false;
                } else {
                  errorSpan.style.display = 'none';
                }
              }
            }
          });

        return isValid;
      }

      function downloadJSONFile() {
        const blob = new Blob([JSON.stringify(formJSON, null, 2)], {
          type: 'application/json',
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'form-data.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }

      createForm(currentQuestionId);
    </script>
  </body>
</html>
